<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Unilink</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* A família Inter, porque a gente ama consistência e um visual clean! */
        body {
            font-family: "Nunito", sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0; /* Um fundinho neutro pra não brigar com o cabeçalho */
            display: flex; /* Para centralizar o contêiner principal */
            justify-content: center; /* Centra horizontalmente o contêiner principal */
            align-items: center; /* Centra verticalmente o contêiner principal */
            min-height: 100vh; /* Garante que o corpo ocupa toda a altura da tela */
        }

        /* Classes para os botões e inputs menores, com bordas arredondadas como a gente gosta */
        .rounded-14px {
            border-radius: 14px;
        }
        
        /* Estilo para a sobreposição escura do filtro */
        .overlay {
            position: fixed; /* Fixo na viewport */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8); /* Escurece 50% */
            z-index: 20; /* Fica acima do conteúdo, mas abaixo do filtro */
            display: none; /* Escondido por padrão */
        }

        /* Estilo para a sobreposição de qualquer Story (genérico) */
        .story-overlay, .create-post-overlay, .camera-overlay, .captured-photo-story-overlay, .create-story-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8); /* Fundo preto semi-transparente para o story */
            display: flex; /* Alterado para flex para que a visibilidade seja controlada APENAS pela classe 'hidden' */
            justify-content: center;
            align-items: center;
            z-index: 50; /* Z-index mais alto para ficar acima de tudo */
            /* Removido 'display: none;' daqui - agora é controlado pela classe 'hidden' do Tailwind */
        }
        .create-post-overlay .content-wrapper {
             /* Cor azul para o conteúdo principal da tela de criar post */
             background-color: #026dad;
             /* degrade suave */
             background: #026dad;
             width: 393px; /* Revertido para o tamanho anterior */
             height: 852px;
             border-radius: 28px; /* Ajuste se precisar de borda redonda */
             display: flex;
             flex-direction: column;
             overflow: hidden; /* Garante que o conteúdo não vaze */
             border: 4px solid black; /* Borda preta como no celular */
        }
        .create-story-overlay .content-wrapper {
            background-color: #f0f0f0; /* Fundo mais claro para criar story */
            width: 393px; /* Largura da tela do celular */
            height: 852px; /* Altura da tela do celular */
            border: 4px solid black; /* Borda preta */
            border-radius: 16px; /* Cantos arredondados */
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Estilo para o overlay de feedback de adição de amigo */
        .feedback-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100; /* Super alto para aparecer por cima de tudo */
            display: none;
        }
        .feedback-box {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Estilo para a sobreposição da câmera no story da Maria */
        .maria-story-video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black; /* Fundo preto para o story de vídeo */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50; /* Z-index mais alto que o normal, mas abaixo dos feedbacks */
        }

        .maria-story-video-overlay .content-wrapper, .camera-overlay .content-wrapper, .captured-photo-story-overlay .content-wrapper {
            width: 393px; /* Largura da tela do celular */
            height: 852px; /* Altura da tela do celular */
            border: 4px solid black; /* Borda preta */
            border-radius: 16px; /* Cantos arredondados */
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
            background-color: #f0f0f0;
        }

        .maria-story-video-overlay video, .camera-overlay video, .create-story-overlay video {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Garante que o vídeo preencha o espaço */
            border-radius: 16px;
        }

        /* Área de clique para navegação em stories (metade esquerda/direita) */
        .story-click-area {
            position: absolute;
            top: 0;
            width: 50%;
            height: 100%;
            cursor: pointer;
            z-index: 1; /* Para estar acima da imagem, mas abaixo do botão de fechar */
        }
        .story-click-area.left { left: 0; z-index: 0; }
        .story-click-area.right { right: 0; z-index: 0}

        /* Estilo para as estrelas, para que fiquem clicáveis e na linha */
        .star-rating img {
            cursor: pointer;
            display: inline-block; /* Garante que fiquem na mesma linha */
        }

        #main::-webkit-scrollbar {
            
    display: none; /* Esconde a barra de rolagem visualmente */
    width: 0; /* Garante que não ocupe espaço horizontal */
    height: 0; /* Garante que não ocupe espaço vertical */
}
    </style>
</head>
<body>
    <div class="w-[393px] h-[852px] border-4 border-black rounded-3xl
                 flex flex-col bg-white shadow-xl overflow-hidden relative">
        <header id="mainHeader" class="h-[75px] bg-[#e5a1ae] flex items-center justify-between px-4 shadow-md transition-all duration-300">
            <div class="h-full flex items-center">
            <span class="text-white font-bold text-[25px]">unilink</span>
            </div>

            <div class="h-full flex items-center">
                <a href="dm1.html">
                    <img src="img/dm_icon.png" alt="Ícone de Mensagens Diretas" class=" w-[46px] object-contain"
                        onerror="this.onerror=null;this.src='https://placehold.co/46x46/aaaaaa/FFFFFF?text=DM';"
                        title="Mensagens Diretas">
                </a>
            </div>
        </header>

        <main class="flex-grow overflow-y-auto overflow-x-hidden  relative z-0" id="main">
            <div class="w-[179px] h-[29px] bg-[#ff6479] rounded-14px flex items-center justify-between px-2 relative mx-auto mt-4 mb-4">
                <span id="timelineTitle" class="text-black font-bold text-[18px] text-left flex-grow flex-shrink-0 truncate">Timeline</span>
                
                <button id="filterButton" class="w-[43px] h-[22px] bg-[#ffb5a6] rounded-14px
                                         flex items-center justify-center shadow-md ml-auto flex-shrink-0">
                    <img src="img/filtro_icon.png" alt="Ícone de Filtro" class="w-[15px] h-[15px] object-contain"
                        onerror="this.onerror=null;this.src='https://placehold.co/15x15/ffb5a6/000000?text=F';"
                        title="Filtro">
                </button>
            </div>

            <div id="storiesContainer" class="w-full flex flex-wrap gap-4 px-2 py-1 pb-1 justify-start">
                <div id="mariaStoryCircle" class="relative w-[63px] h-[63px] rounded-full border-[3px] border-black flex-shrink-0 flex items-center justify-center cursor-pointer">
                    <img src="img/maria.png" alt="Story de Maria" id="mariaStoryImage" class="w-[53px] h-[53px] rounded-full object-cover"
                        onerror="this.onerror=null;this.src='https://placehold.co/53x53/cccccc/000000?text=M';"
                    >
                    <div id="mariaAddButton" class="absolute bottom-0 right-0 w-[20px] h-[20px] rounded-full bg-[#000080] border-[2px] border-white flex items-center justify-center -mb-1 -mr-1 cursor-pointer">
                        <span class="text-white font-bold text-sm">+</span>
                    </div>
                </div>

                <div id="ciclanoStoryCircle" class="relative w-[63px] h-[63px] rounded-full border-[3px] border-[#000080] flex-shrink-0 flex items-center justify-center cursor-pointer">
                    <img src="img/ciclano.png" alt="Story do Ciclano" class="w-[53px] h-[53px] rounded-full object-cover"
                        onerror="this.onerror=null;this.src='https://placehold.co/53x53/cccccc/000000?text=C';"
                    >
                </div>
                
                <div class="relative w-[63px] h-[63px] rounded-full border-[3px] border-[#000080] flex-shrink-0 flex items-center justify-center">
                    <img src="https://placehold.co/53x53/cccccc/000000?text=A" alt="Story do Amigo A" class="w-[53px] h-[53px] rounded-full object-cover"
                    >
                </div>
                </div>

            <div class="tweet-card w-[383px] border-b-2 border-black flex flex-col justify-between pt-2 pb-2 mx-auto relative" data-campus="ccet" data-type="tweet">
                <div class="flex items-center px-2">
                    <img src="img/fulano.png" alt="Foto de Perfil do Fulano" class="w-[44px] h-[44px] rounded-full object-cover mr-2"
                        onerror="this.onerror=null;this.src='https://placehold.co/44x44/cccccc/000000?text=F';">
                    <span class="font-bold text-[14px] text-gray-800">Fulano - CCET - Sistemas de Informação</span>
                </div>
                <p class="text-[14px] text-justify text-gray-700 px-2 mt-1 mb-1 leading-tight">
                    gente, tô fazendo uma pesquisa pra IHC - Modelo de Usuário, podem responder se puderem? obrigado!
                    <a href="#" class="text-[#004aad] underline">bit.ly/unilink_rio</a>
                </p>
                <div class="flex justify-between items-center px-2">
                    <img data-username="Fulano" class="add-friend-icon w-[20px] h-[20px] object-contain cursor-pointer" src="img/adicionar.png" alt="Ícone de Adicionar" 
                        onerror="this.onerror=null;this.src='https://placehold.co/20x20/cccccc/000000?text=ADD';">
                    <div class="flex items-center">
                        <img class="like-icon w-[20px] h-[20px] object-contain mr-1 cursor-pointer" src="img/like.png" alt="Ícone de Curtir"
                            onerror="this.onerror=null;this.src='https://placehold.co/20x20/cccccc/000000?text=LIKE';">
                        <span class="like-count font-bold text-[11px] text-gray-800" data-liked="false">123</span>
                    </div>
                </div>
            </div>

            <div class="tweet-card w-[383px] border-b-2 border-black flex flex-col justify-between pt-2 pb-2 mx-auto relative" data-campus="cch" data-type="tweet">
                <div class="flex items-center px-2">
                    <img src="img/ciclano.png" alt="Foto de Perfil do Ciclano" class="w-[44px] h-[44px] rounded-full object-cover mr-2"
                        onerror="this.onerror=null;this.src='https://placehold.co/44x44/cccccc/000000?text=C';">
                    <span class="font-bold text-[14px] text-gray-800">Ciclano - CCH - Biblioteconomia</span>
                </div>
                
                <div class="w-[370px] mx-auto my-2 relative">
                    <iframe data-testid="embed-iframe" style="border-radius:12px" src="https://open.spotify.com/embed/track/5p48T2Tqm7xX3ym7uslGOg?utm_source=generator&theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
                </div>
                
                <div class="star-rating flex justify-between w-[360px] mx-auto mt-1 mb-1" data-rating="0">
                    <img src="img/estrelaapagada.png" alt="Estrela 1" class="w-[25px] h-[25px]" data-value="1"
                        onerror="this.onerror=null;this.src='https://placehold.co/20x20/cccccc/000000?text=E';">
                    <img src="img/estrelaapagada.png" alt="Estrela 2" class="w-[25px] h-[25px]" data-value="2"
                        onerror="this.onerror=null;this.src='https://placehold.co/20x20/cccccc/000000?text=E';">
                    <img src="img/estrelaapagada.png" alt="Estrela 3" class="w-[25px] h-[25px]" data-value="3"
                        onerror="this.onerror=null;this.src='https://placehold.co/20x20/cccccc/000000?text=E';">
                    <img src="img/estrelaapagada.png" alt="Estrela 4" class="w-[25px] h-[25px]" data-value="4"
                        onerror="this.onerror=null;this.src='https://placehold.co/20x20/cccccc/000000?text=E';">
                    <img src="img/estrelaapagada.png" alt="Estrela 5" class="w-[25px] h-[25px]" data-value="5"
                        onerror="this.onerror=null;this.src='https://placehold.co/20x20/cccccc/000000?text=E';">
                </div>
            </div>

            <div class="tweet-card w-[383px] border-b-2 border-black flex flex-col justify-between pt-2 pb-2 mx-auto relative" data-campus="cch" data-type="tweet">
                <div class="flex items-center px-2">
                    <img src="img/beltrana.png" alt="Foto de Perfil da Beltrana" class="w-[44px] h-[44px] rounded-full object-cover mr-2"
                        onerror="this.onerror=null;this.src='https://placehold.co/44x44/cccccc/000000?text=B';">
                    <span class="font-bold text-[14px] text-gray-800">Beltrana - CCH - História</span>
                </div>
                <div class="w-[370px] h-[52px] bg-gray-200 rounded-lg flex items-center px-2 mx-auto my-2 relative">
                    <img src="img/folha.png" alt="Capa de Livro/Leitura" class="w-[40px] h-[40px] rounded object-cover mr-2"
                        onerror="this.onerror=null;this.src='https://placehold.co/40x40/000000/FFFFFF?text=L';"
                    >
                    <div class="flex flex-col justify-center flex-grow">
                        <span class="font-bold text-[13px] text-gray-800">Lendo "Por flores e gramados"</span>
                        <span class="text-[13px] text-gray-800 mt-0.5">Por Roberta Castro</span>
                    </div>
                </div>
                
                <div class="flex justify-between items-center px-2">
                    <img data-username="Beltrana" class="add-friend-icon w-[20px] h-[20px] object-contain cursor-pointer" src="img/adicionar.png" alt="Ícone de Adicionar" 
                        onerror="this.onerror=null;this.src='https://placehold.co/20x20/cccccc/000000?text=ADD';">
                    <div class="flex items-center">
                        <img class="like-icon w-[20px] h-[20px] object-contain mr-1 cursor-pointer" src="img/like.png" alt="Ícone de Curtir"
                            onerror="this.onerror=null;this.src='https://placehold.co/20x20/cccccc/000000?text=LIKE';">
                        <span class="like-count font-bold text-[11px] text-gray-800" data-liked="false">123</span>
                    </div>
                </div>
            </div>

            <div class="tweet-card w-[383px] border-b-2 border-black flex flex-col justify-between pt-2 pb-2 mx-auto relative" data-type="job-opening">
                <div class="flex items-center px-2">
                    <div class="w-[44px] h-[44px] rounded-full bg-[#ff7a28] flex items-center justify-center mr-2">
                        <img src="img/trabalho.png" alt="Ícone de Trabalho" class="w-[40px] h-[40px] object-contain"
                            onerror="this.onerror=null;this.src='https://placehold.co/40x40/cccccc/000000?text=TRB';">
                    </div>
                    <span class="font-bold text-[14px] text-gray-800">Oportunidade de Emprego</span>
                </div>
                <p class="text-[14px] text-left text-gray-700 px-2 mt-1 mb-2 leading-tight">
                    Vaga de Estágio como Instrutor de TI
                </p>
                <div class="flex justify-between items-center px-2 w-full">
                    <a href="http://www.vagas.com/instrutor_ti" target="_blank" class="w-[300px] h-[22px] bg-[#b7cee8] text-blue-800 rounded-14px flex items-center justify-center text-[14px] font-bold no-underline mr-2">
                        www.vagas.com/instrutor_ti
                    </a>
                    <div class="flex items-center flex-shrink-0">
                        <img class="like-icon w-[20px] h-[20px] object-contain mr-1 cursor-pointer" src="img/like.png" alt="Ícone de Curtir"
                            onerror="this.onerror=null;this.src='https://placehold.co/20x20/cccccc/000000?text=LIKE';">
                        <span class="like-count font-bold text-[11px] text-gray-800" data-liked="false">123</span>
                    </div>
                </div>
            </div>

            <div class="w-[300px] h-[200px] bg-transparent mx-auto"></div>
        </main>

        <div id="overlay" class="overlay"></div>

        <div id="filterMenu" class="absolute top-[88px] left-1/2 -translate-x-1/2
                                     w-[350px] h-[120px] bg-[#ffb5a6] rounded-14px
                                     shadow-lg p-3 z-30 hidden flex flex-col items-start justify-between">
            <div class="flex items-center justify-between w-[calc(100%-20px)] mx-auto mt-2 mb-2">
                <span class="text-black font-bold text-[20px] text-gray-800">Apenas vagas de emprego:</span>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" value="" class="sr-only peer" id="jobFilterSwitch">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                </label>
            </div>

            <div class="flex items-center justify-between w-[calc(100%-20px)] mx-auto mt-2 mb-2">
                <span id="campusLabel" class="text-black font-bold text-[20px]">Campus/Prédio:</span>
                <select id="campusSelect" class="bg-[#e86b70] text-white rounded-md p-1 text-[18px] focus:outline-none">
                    <option value="todos">Todos</option>
                    <option value="cch">CCH</option>
                    <option value="ccet">CCET</option>
                    <option value="ccjp">CCJP</option>
                    <option value="ib">IB</option>
                </select>
            </div>
        </div>

        <footer class="w-full h-[60px] bg-[#4f603e] flex items-center justify-between  z-10">
            <a href="home1.html" class="w-[78.6px] h-[60px] bg-[#657d4d] flex items-center justify-around">
                <img src="img/home.png" alt="Ícone Home" class="w-[36px] h-[36px] object-contain"
                    onerror="this.onerror=null;this.src='https://placehold.co/36x36/cccccc/FFFFFF?text=H';">
            </a>
            
            <a href="usuarios.html" class="w-[78.6px] h-[60px] flex items-center justify-around">
                <img src="img/pesquisar.png" alt="Ícone Pesquisar" class="w-[36px] h-[36px] object-contain"
                    onerror="this.onerror=null;this.src='https://placehold.co/36x36/cccccc/FFFFFF?text=P';">
            </a>

            <a href="jogaprolo.html" class="w-[78.6px] h-[60px] flex items-center justify-around">
                <img src="img/jogaprolo.png" alt="Ícone Jogaprolo" class="w-[36px] h-[36px] object-contain"
                    onerror="this.onerror=null;this.src='https://placehold.co/36x36/cccccc/FFFFFF?text=J';">
            </a>

            <a href="agenda.html" class="w-[78.6px] h-[60px]  flex items-center justify-around">
                <img src="img/agenda.png" alt="Ícone Agenda" class="w-[36px] h-[36px] object-contain"
                    onerror="this.onerror=null;this.src='https://placehold.co/36x36/cccccc/FFFFFF?text=A';">
            </a>

            <a href="seuperfil.html" class="w-[78.6px] h-[60px] flex items-center justify-around">
                <img src="img/seuperfil.png" alt="Ícone Seu Perfil" class="w-[36px] h-[36px] object-contain"
                    onerror="this.onerror=null;this.src='https://placehold.co/36x36/cccccc/FFFFFF?text=S';">
            </a>
        </footer>
        
        <button id="createPostFab" class="absolute bottom-[80px] right-[20px] w-[50px] h-[50px] rounded-full bg-[#026dad] border-[2px] border-black flex items-center justify-center text-white text-3xl font-bold shadow-lg z-40">
            +
        </button>
    </div>

    <div id="mariaStoryOverlay" class="maria-story-video-overlay hidden">
        <div class="content-wrapper">
            <video id="mariaStoryVideo" autoplay playsinline muted class="w-full h-full object-cover"></video>
            <button id="closeMariaStoryButton" class="absolute bottom-[20px] left-1/2 -translate-x-1/2 w-[148px] h-[33px] bg-[#002c5c] text-white font-bold text-[14px] rounded-14px flex items-center justify-center">
                Voltar para home
            </button>
        </div>
    </div>

    <div id="cameraOverlay" class="camera-overlay hidden">
        <div class="content-wrapper">
            <video id="cameraVideo" autoplay playsinline class="w-full h-full object-cover"></video>
            <button id="capturePhotoButton" class="absolute bottom-[20px] left-1/2 -translate-x-1/2 w-[60px] h-[60px] rounded-full bg-white border-4 border-black flex items-center justify-center shadow-lg">
                <div class="w-[40px] h-[40px] rounded-full bg-red-500"></div>
            </button>
            <button id="closeCameraButton" class="absolute top-[20px] right-[20px] text-white text-3xl font-bold">
                X
            </button>
        </div>
        <canvas id="captureCanvas" class="hidden"></canvas>
    </div>

    <div id="capturedPhotoStoryOverlay" class="captured-photo-story-overlay hidden">
        <div class="content-wrapper">
            <img id="capturedStoryImage" src="" alt="Sua Foto de Story" class="w-full h-full object-contain">
            <button id="closeCapturedStoryButton" class="absolute bottom-[20px] left-1/2 -translate-x-1/2 w-[148px] h-[33px] bg-[#002c5c] text-white font-bold text-[14px] rounded-14px flex items-center justify-center">
                Voltar para home
            </button>
        </div>
    </div>

    <div id="createStoryOverlay" class="create-story-overlay hidden">
        <div class="content-wrapper">
            <video id="createStoryVideoPreview" autoplay playsinline muted class="w-full h-full object-cover"></video>
            <button id="takePhotoForStoryButton" class="absolute bottom-[80px] left-1/2 -translate-x-1/2 w-[60px] h-[60px] rounded-full bg-red-500 border-[2px] border-black flex items-center justify-center shadow-lg">
                <img src="img/foto.png" alt="Tirar Foto" class="w-[35px] h-[35px] object-contain"
                    onerror="this.onerror=null;this.src='https://placehold.co/35x35/cccccc/FFFFFF?text=FOTO';">
            </button>
            <button id="closeCreateStoryOverlayButton" class="absolute bottom-[20px] left-1/2 -translate-x-1/2 w-[148px] h-[33px] bg-[#002c5c] text-white font-bold text-[14px] rounded-14px flex items-center justify-center">
                Voltar para home
            </button>
        </div>
        <canvas id="createStoryCanvas" class="hidden"></canvas>
    </div>


    <div id="ciclanoStoryOverlay" class="story-overlay hidden">
        <div class="relative w-[393px] h-[852px] flex flex-col items-center justify-between">
            <button id="closeCiclanoStoryButtonTop" class="absolute top-[20px] inset-x-0 mx-auto w-[calc(100%-40px)] h-[33px] bg-red-500 text-white font-bold text-[14px] rounded-14px flex items-center justify-center z-20">
                Voltar para home
            </button>
            <img id="ciclanoStoryImage" src="img/storyciclano1.png" 
                alt="Story do Ciclano" 
                class="w-full h-full border-4 border-black rounded-3xl object-cover"
                onerror="this.onerror=null;this.src='https://placehold.co/393x852/000000/FFFFFF?text=STORY+CICLANO+1';">
            
            <div class="story-click-area left" id="ciclanoStoryLeftClick"></div>
            <div class="story-click-area right" id="ciclanoStoryRightClick"></div>
            
            <div class="absolute bottom-[20px] w-[350px] flex items-center justify-between px-2">
                <input type="text" id="ciclanoStoryInput" placeholder="Digite aqui"
                        class="flex-grow h-[36px] rounded-[18px] border-[2px] border-gray-300 px-4 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button id="ciclanoStorySendButton" class="w-[54px] h-[36px] bg-[#e5a1ae] rounded-[18px] border-[2px] border-black flex items-center justify-center ml-2">
                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                    </svg>
                </button>
            </div>
            <button id="ciclanoReactionButton" class="absolute right-[25px] bottom-[65px] w-[50px] h-[50px] rounded-full bg-[#e5a1ae] border-[2px] border-black flex items-center justify-center shadow-md z-10">
                <img src="img/adicionarreacao.png" alt="Adicionar Reação" class="w-[33px] h-[33px] object-contain"
                    onerror="this.onerror=null;this.src='https://placehold.co/33x33/e5a1ae/000000?text=R';">
            </button>
            <div id="ciclanoReactionMenu" class="absolute right-[25px] bottom-[125px] w-[50px] h-[95px] rounded-full bg-white shadow-lg p-1 z-20 flex flex-col justify-around items-center hidden" style="border: 1px solid #e5a1ae;">
                <button id="ciclanoReactionHeart" class="w-[38px] h-[38px] rounded-full bg-[#4f603e] flex items-center justify-center">
                    <img src="img/coracao.png" alt="Coração" class="w-[31px] h-[26px] object-contain"
                        onerror="this.onerror=null;this.src='https://placehold.co/31x26/4f603e/FFFFFF?text=♥';">
                </button>
                <button id="ciclanoReactionStars" class="w-[38px] h-[38px] rounded-full bg-[#4f603e] flex items-center justify-center mt-1">
                    <img src="img/estrelinhas.png" alt="Estrelas" class="w-[31px] h-[31px] object-contain"
                        onerror="this.onerror=null;this.src='https://placehold.co/31x31/4f603e/FFFFFF?text=★';">
                </button>
            </div>
        </div>
    </div>

    <div id="amigoAStoryOverlay" class="story-overlay hidden">
        <div class="relative w-[393px] h-[852px] flex flex-col items-center justify-between">
            <button id="closeAmigoAStoryButtonTop" class="absolute top-[20px] inset-x-0 mx-auto w-[calc(100%-40px)] h-[33px] bg-red-500 text-white font-bold text-[14px] rounded-14px flex items-center justify-center z-20">
                Voltar para home
            </button>
            <img id="amigoAStoryImage" src="https://placehold.co/393x852/000000/FFFFFF?text=STORY+AMIGO+A" 
                alt="Story do Amigo A" 
                class="w-full h- border-4 border-black rounded-3xl object-cover"
                onerror="this.onerror=null;this.src='https://placehold.co/393x852/000000/FFFFFF?text=STORY+AMIGO+A';">
            
            <div class="story-click-area left" id="amigoAStoryLeftClick"></div>
            <div class="story-click-area right" id="amigoAStoryRightClick"></div>
            
            <div class="absolute bottom-[20px] w-[350px] flex items-center justify-between px-2">
                <input type="text" id="amigoAStoryInput" placeholder="Digite aqui"
                        class="flex-grow h-[36px] rounded-[18px] border-[2px] border-gray-300 px-4 text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button id="amigoAStorySendButton" class="w-[54px] h-[36px] bg-[#e5a1ae] rounded-[18px] border-[2px] border-black flex items-center justify-center ml-2">
                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                    </svg>
                </button>
            </div>
            <button id="amigoAReactionButton" class="absolute right-[25px] bottom-[65px] w-[50px] h-[50px] rounded-full bg-[#e5a1ae] border-[2px] border-black flex items-center justify-center shadow-md z-10">
                <img src="img/adicionarreacao.png" alt="Adicionar Reação" class="w-[33px] h-[33px] object-contain"
                    onerror="this.onerror=null;this.src='https://placehold.co/33x33/e5a1ae/000000?text=R';">
            </button>
            <div id="amigoAReactionMenu" class="absolute right-[25px] bottom-[125px] w-[50px] h-[95px] rounded-full bg-white shadow-lg p-1 z-20 flex flex-col justify-around items-center hidden" style="border: 1px solid #e5a1ae;">
                <button id="amigoAReactionHeart" class="w-[38px] h-[38px] rounded-full bg-[#4f603e] flex items-center justify-center">
                    <img src="img/coracao.png" alt="Coração" class="w-[31px] h-[26px] object-contain"
                        onerror="this.onerror=null;this.src='https://placehold.co/31x26/4f603e/FFFFFF?text=♥';">
                </button>
                <button id="amigoAReactionStars" class="w-[38px] h-[38px] rounded-full bg-[#4f603e] flex items-center justify-center mt-1">
                    <img src="img/estrelinhas.png" alt="Estrelas" class="w-[31px] h-[31px] object-contain"
                        onerror="this.onerror=null;this.src='https://placehold.co/31x31/4f603e/FFFFFF?text=★';">
                </button>
            </div>
        </div>
    </div>


    <script>
        let mariaStoryLocalStream; // Variável para o stream da webcam do story da Maria
        let cameraLocalStream; // Variável para o stream da webcam da câmera de foto
        let capturedPhotoDataUrl = null; // Para armazenar a foto tirada
        let createStoryLocalStream; // Variável para o stream da câmera na tela de criar story

        document.addEventListener('DOMContentLoaded', (event) => {
            const filterButton = document.getElementById('filterButton');
            const filterMenu = document.getElementById('filterMenu');
            const overlay = document.getElementById('overlay');

            // Referências para os elementos do story da Maria
            const mariaStoryCircle = document.getElementById('mariaStoryCircle');
            const mariaStoryImageElement = document.getElementById('mariaStoryImage'); 
            const mariaAddButton = document.getElementById('mariaAddButton'); 
            const mariaStoryOverlay = document.getElementById('mariaStoryOverlay');
            const closeMariaStoryButton = document.getElementById('closeMariaStoryButton');
            const mariaStoryVideo = document.getElementById('mariaStoryVideo'); 
            let mariaTouchStartY = 0; 

            // Referências para os elementos do story do Ciclano 
            const ciclanoStoryCircle = document.getElementById('ciclanoStoryCircle');
            const ciclanoStoryOverlay = document.getElementById('ciclanoStoryOverlay');
            const ciclanoStories = ['img/storyciclano1.png', 'img/storyciclano2.png'];
            let currentCiclanoStoryIndex = 0;
            let ciclanoTouchStartY = 0;
            const closeCiclanoStoryButtonTop = document.getElementById('closeCiclanoStoryButtonTop'); 

            // Referências para os stories do Amigo A e B (Amigo B foi removido do HTML)
            const amigoAStoryCircle = document.getElementById('amigoAStoryCircle');
            const amigoAStoryOverlay = document.getElementById('amigoAStoryOverlay');
            const amigoAStories = ['https://placehold.co/393x852/000000/FFFFFF?text=STORY+AMIGO+A+1', 'https://placehold.co/393x852/000000/FFFFFF?text=STORY+AMIGO+A+2'];
            let currentAmigoAStoryIndex = 0;
            let amigoATouchStartY = 0;
            const closeAmigoAStoryButtonTop = document.getElementById('closeAmigoAStoryButtonTop'); 

            // Referências para a tela de Criar Post
            const createPostFab = document.getElementById('createPostFab');
            const createPostOverlay = document.getElementById('createPostOverlay');
            const closeCreatePostButton = document.getElementById('closeCreatePostButton');
            const publishPostButton = document.getElementById('publishPostButton'); 
            const postContentInput = document.getElementById('postContentInput');

            // Referências para os botões de anexar mídia
            const attachImageButton = document.getElementById('attachImageButton');
            const attachFileButton = document.getElementById('attachFileButton');
            const imageFileInput = document.getElementById('imageFileInput');
            const fileAttachmentInput = document.getElementById('fileAttachmentInput');
            const attachedMediaPreview = document.getElementById('attachedMediaPreview');
            const previewImage = document.getElementById('previewImage');
            const previewFileName = document.getElementById('previewFileName');
            let attachedFileType = null;
            let attachedFileSrc = null;

            // Referência para o título da timeline
            const timelineTitle = document.getElementById('timelineTitle');
            const mainHeader = document.getElementById('mainHeader');

            // Overlay de Feedback de Amigo
            const friendFeedbackOverlay = document.getElementById('friendFeedbackOverlay');
            const feedbackMessage = document.getElementById('feedbackMessage');
            const feedbackOkButton = document.getElementById('feedbackOkButton');

            // Elementos da Câmera para Tirar Foto (AGORA SÓ UM OVERLAY, SEM BOTÃO NO HTML PRINCIPAL)
            const cameraOverlay = document.getElementById('cameraOverlay');
            const cameraVideo = document.getElementById('cameraVideo');
            const capturePhotoButton = document.getElementById('capturePhotoButton');
            const closeCameraButton = document.getElementById('closeCameraButton');
            const captureCanvas = document.getElementById('captureCanvas');

            // Elementos do Story da Foto Capturada
            const capturedPhotoStoryOverlay = document.getElementById('capturedPhotoStoryOverlay');
            const capturedStoryImage = document.getElementById('capturedStoryImage');
            const closeCapturedStoryButton = document.getElementById('closeCapturedStoryButton');
            const storiesContainer = document.getElementById('storiesContainer');
            let newStoryCounter = 0; // Para gerar IDs únicos para novos stories

            // NOVO: Elementos da tela de Criar Story
            const createStoryOverlay = document.getElementById('createStoryOverlay');
            const createStoryVideoPreview = document.getElementById('createStoryVideoPreview');
            const takePhotoForStoryButton = document.getElementById('takePhotoForStoryButton');
            const closeCreateStoryOverlayButton = document.getElementById('closeCreateStoryOverlayButton');
            const createStoryCanvas = document.getElementById('createStoryCanvas'); // Canvas para capturar a foto do story


            // --- Funções Comuns ---

            function toggleFilterMenu() { 
                if (filterMenu) { 
                    if (filterMenu.classList.contains('hidden')) {
                        filterMenu.classList.remove('hidden');
                        if (overlay) overlay.style.display = 'block'; 
                    } else {
                        filterMenu.classList.add('hidden');
                        if (overlay) overlay.style.display = 'none'; 
                    }
                }
            }

            // AQUI: A função closeAllOverlays foi atualizada para parar o stream da câmera de criar story
            function closeAllOverlays() {
                if (mariaStoryOverlay && !mariaStoryOverlay.classList.contains('hidden')) { 
                    stopMariaStoryCamera(); 
                }
                if (cameraOverlay && !cameraOverlay.classList.contains('hidden')) {
                    stopCamera();
                }
                if (createStoryOverlay && !createStoryOverlay.classList.contains('hidden')) { // NOVO
                    stopCreateStoryCamera(); // NOVO
                }

                if (mariaStoryOverlay) mariaStoryOverlay.classList.add('hidden');
                if (ciclanoStoryOverlay) ciclanoStoryOverlay.classList.add('hidden');
                if (amigoAStoryOverlay) amigoAStoryOverlay.classList.add('hidden');
                // if (amigoBStoryOverlay) amigoBStoryOverlay.classList.add('hidden'); // REMOVIDO DO HTML
                if (createPostOverlay) createPostOverlay.classList.add('hidden');
                if (friendFeedbackOverlay) friendFeedbackOverlay.style.display = 'none';
                if (ciclanoReactionMenu) ciclanoReactionMenu.classList.add('hidden');
                if (amigoAReactionMenu) amigoAReactionMenu.classList.add('hidden');
                // if (amigoBReactionMenu) amigoBReactionMenu.classList.add('hidden'); // REMOVIDO DO HTML
                if (cameraOverlay) cameraOverlay.classList.add('hidden'); 
                if (capturedPhotoStoryOverlay) capturedPhotoStoryOverlay.classList.add('hidden'); 
                if (createStoryOverlay) createStoryOverlay.classList.add('hidden'); // NOVO
            }

            function setupSwipeToClose(overlayElement, touchStartYVarName) { 
                if (overlayElement) { 
                    overlayElement.addEventListener('touchstart', (e) => {
                        window[touchStartYVarName] = e.touches[0].clientY;
                    });

                    overlayElement.addEventListener('touchend', (e) => {
                        const touchEndY = e.changedTouches[0].clientY;
                        if (touchEndY - window[touchStartYVarName] > 80) { 
                            closeAllOverlays();
                        }
                    });
                }
            }

            // --- Lógica do Filtro ---
            if (filterButton) { 
                filterButton.addEventListener('click', function(event) {
                    event.stopPropagation(); 
                    toggleFilterMenu();
                });
            }

            if (overlay) { 
                overlay.addEventListener('click', function() {
                    toggleFilterMenu();
                });
            }

            document.addEventListener('click', function(event) {
                const isClickInsideFilterMenu = (filterMenu && filterButton) ? 
                                                (filterButton.contains(event.target) || filterMenu.contains(event.target)) : false;

                if (!isClickInsideFilterMenu && filterMenu && !filterMenu.classList.contains('hidden')) {
                    toggleFilterMenu();
                }
            });

            const tweetCards = document.querySelectorAll('.tweet-card');
            const jobFilterSwitch = document.getElementById('jobFilterSwitch');
            const campusSelect = document.getElementById('campusSelect');
            const campusLabel = document.getElementById('campusLabel');

            function applyFilters() {
                const jobFilterActive = jobFilterSwitch ? jobFilterSwitch.checked : false;
                const selectedCampus = campusSelect ? campusSelect.value : 'todos';

                if (timelineTitle) {
                    if (jobFilterActive) {
                        timelineTitle.textContent = 'Vagas';
                    } else if (selectedCampus === 'todos') {
                        timelineTitle.textContent = 'Timeline';
                    } else {
                        timelineTitle.textContent = selectedCampus.toUpperCase();
                    }
                }

                if (mainHeader) {
                    mainHeader.classList.remove('h-[75px]', 'h-[60px]', 'h-[63px]');

                    if (jobFilterActive) {
                        mainHeader.classList.add('h-[60px]');
                    } else if (selectedCampus === 'cch') {
                        mainHeader.classList.add('h-[63px]');
                    } else if (selectedCampus === 'ccet' || selectedCampus === 'ccjp' || selectedCampus === 'ib') {
                        mainHeader.classList.add('h-[60px]');
                    }
                    else {
                        mainHeader.classList.add('h-[75px]');
                    }
                }

                if (campusSelect && campusLabel) {
                    if (jobFilterActive) {
                        campusSelect.disabled = true;
                        campusSelect.classList.add('opacity-50');
                        campusSelect.classList.remove('text-white');
                        campusSelect.classList.add('text-gray-400');
                        campusLabel.classList.add('opacity-50', 'text-gray-400');
                        campusLabel.classList.remove('text-gray-800');
                    } else {
                        campusSelect.disabled = false;
                        campusSelect.classList.remove('opacity-50');
                        campusSelect.classList.remove('text-gray-400');
                        campusSelect.classList.add('text-white');
                        campusLabel.classList.remove('opacity-50', 'text-gray-400');
                        campusLabel.classList.add('text-gray-800');
                    }
                }

                tweetCards.forEach(card => {
                    const isJobOpening = card.dataset.type === 'job-opening';
                    const cardCampus = card.dataset.campus;

                    let showCard = true;

                    if (jobFilterActive) {
                        showCard = isJobOpening;
                    } else {
                        if (selectedCampus === 'todos') {
                            showCard = true;
                        } else if (cardCampus !== selectedCampus && !isJobOpening) {
                            showCard = false;
                        } else if (isJobOpening) {
                            showCard = true;
                        }
                    }

                    if (showCard) {
                        card.classList.remove('hidden');
                    } else {
                        card.classList.add('hidden');
                    }
                });
            }

            if (jobFilterSwitch) jobFilterSwitch.addEventListener('change', applyFilters);
            if (campusSelect) campusSelect.addEventListener('change', applyFilters);

            applyFilters();

            // --- Lógica das Estrelas de Avaliação ---
            const starRatings = document.querySelectorAll('.star-rating');
            starRatings.forEach(ratingContainer => {
                const stars = ratingContainer.querySelectorAll('img');
                const currentRating = parseInt(ratingContainer.dataset.rating);

                function updateStars(value) {
                    stars.forEach((star, index) => {
                        star.src = (index < value) ? 'img/estrelaacesa.png' : 'img/estrelaapagada.png';
                        star.onerror = null;
                    });
                    ratingContainer.dataset.rating = value;
                }
                updateStars(currentRating);
                stars.forEach(star => {
                    star.addEventListener('click', function() {
                        const value = parseInt(this.dataset.value);
                        updateStars(value);
                        console.log('Avaliação enviada:', value);
                    });
                });
            });

            // --- Lógica dos botões de Curtir ---
            document.querySelectorAll('.like-icon').forEach(button => {
                button.addEventListener('click', function() {
                    const likeCountSpan = this.nextElementSibling; // O span com a contagem de likes
                    let currentLikes = parseInt(likeCountSpan.textContent);
                    const hasLiked = likeCountSpan.dataset.liked === 'true';

                    if (hasLiked) {
                        this.src = 'img/like.png';
                        currentLikes--;
                        likeCountSpan.dataset.liked = 'false';
                    } else {
                        this.src = 'img/like2.png';
                        currentLikes++;
                        likeCountSpan.dataset.liked = 'true';
                    }
                    likeCountSpan.textContent = currentLikes;
                });
            });


            // --- Lógica do Botão de Adicionar Amigo ---
            document.querySelectorAll('.add-friend-icon').forEach(button => {
                if (button.dataset.username === "Maria") {
                    button.classList.add('hidden');
                    return; 
                }

                button.addEventListener('click', function() {
                    const username = this.dataset.username;
                    const isAdded = this.src.includes('adicionar2.png');

                    if (!isAdded) {
                        feedbackMessage.textContent = `Você adicionou ${username} aos amigos! Entre no Chat para conversar com ele(a/u).`;
                        friendFeedbackOverlay.style.display = 'flex';
                        this.src = 'img/adicionar2.png';
                    } else {
                        feedbackMessage.textContent = `${username} já é seu amigo(a/u)!`;
                        friendFeedbackOverlay.style.display = 'flex';
                    }
                });
            });

            if (feedbackOkButton) {
                feedbackOkButton.addEventListener('click', function() {
                    friendFeedbackOverlay.style.display = 'none';
                });
            }


            // --- Lógica da Câmera no Story da Maria ---
            async function startMariaStoryCamera() {
                try {
                    mariaStoryLocalStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
                    mariaStoryVideo.srcObject = mariaStoryLocalStream;
                    mariaStoryOverlay.classList.remove('hidden');
                    mariaStoryVideo.classList.remove('hidden');
                }
                // AQUI: Erro ao acessar a câmera no story da Maria
                catch (error) {
                    console.error('Erro ao acessar a câmera para o story da Maria:', error);
                    alert('Amada, não consegui acessar sua câmera para o story! Tem certeza que deu permissão?');
                    mariaStoryVideo.classList.add('hidden');
                    // Se não conseguir a câmera, talvez exibir uma imagem de fallback ou mensagem na overlay.
                    // Por agora, apenas escondo o vídeo e mostro a overlay vazia se a câmera falhar.
                    mariaStoryOverlay.classList.remove('hidden'); 
                }
            }

            function stopMariaStoryCamera() {
                if (mariaStoryLocalStream) {
                    mariaStoryLocalStream.getTracks().forEach(track => track.stop());
                    mariaStoryLocalStream = null;
                    mariaStoryVideo.srcObject = null;
                }
            }

            if (mariaStoryImageElement) { 
                mariaStoryImageElement.addEventListener('click', function(event) {
                    event.stopPropagation();
                    closeAllOverlays();
                    startMariaStoryCamera();
                });
            }

            if (mariaAddButton) {
                mariaAddButton.addEventListener('click', function(event) {
                    event.stopPropagation();
                    closeAllOverlays();
                    
                    // AQUI: Ao clicar no + do story da Maria, abre a tela de criar story com a câmera
                    startCreateStoryCamera(); // Chama a função para ativar a câmera na tela de criar story
                });
            }

            if (closeMariaStoryButton) {
                closeMariaStoryButton.addEventListener('click', function() {
                    closeAllOverlays();
                });
            }
            if (mariaStoryOverlay) {
                setupSwipeToClose(mariaStoryOverlay, 'mariaTouchStartY');
            }


            // --- Lógica do Story do Ciclano ---
            function showCiclanoStory(index) {
                if (ciclanoStoryImage && ciclanoStories.length > 0) { 
                    if (index >= 0 && index < ciclanoStories.length) {
                        currentCiclanoStoryIndex = index;
                        ciclanoStoryImage.src = ciclanoStories[currentCiclanoStoryIndex];
                        ciclanoStoryImage.onerror = function() {
                            this.onerror = null;
                            this.src = 'https://placehold.co/393x852/000000/FFFFFF?text=STORY+CICLANO+ERRO';
                        };
                    } else if (index >= ciclanoStories.length) {
                        closeAllOverlays();
                    } else if (index < 0) {
                        closeAllOverlays();
                    }
                }
            }

            function openCiclanoStory() {
                closeAllOverlays();
                if (ciclanoStoryOverlay) ciclanoStoryOverlay.classList.remove('hidden');
                currentCiclanoStoryIndex = 0;
                showCiclanoStory(currentCiclanoStoryIndex);
            }

            if (ciclanoStoryCircle) {
                ciclanoStoryCircle.addEventListener('click', openCiclanoStory);
            }

            if (ciclanoStoryOverlay) {
                setupSwipeToClose(ciclanoStoryOverlay, 'ciclanoTouchStartY');
            }
            if (closeCiclanoStoryButtonTop) {
                closeCiclanoStoryButtonTop.addEventListener('click', closeAllOverlays);
            }


            // --- Lógica do Story do Amigo A ---
            function showAmigoAStory(index = 0) {
                closeAllOverlays();
                if (amigoAStoryOverlay) amigoAStoryOverlay.classList.remove('hidden');
                currentAmigoAStoryIndex = index;
                if (document.getElementById('amigoAStoryImage') && amigoAStories.length > 0) { 
                    document.getElementById('amigoAStoryImage').src = amigoAStories[currentAmigoAStoryIndex];
                    document.getElementById('amigoAStoryImage').onerror = function() {
                        this.onerror = null;
                        this.src = 'https://placehold.co/393x852/000000/FFFFFF?text=STORY+AMIGO+A+ERRO';
                    };
                }
                if (document.getElementById('amigoAStoryInput')) document.getElementById('amigoAStoryInput').value = '';
                if (document.getElementById('amigoAReactionMenu')) document.getElementById('amigoAReactionMenu').classList.add('hidden');
            }

            function openAmigoAStory() {
                closeAllOverlays();
                if (amigoAStoryOverlay) amigoAStoryOverlay.classList.remove('hidden');
                currentAmigoAStoryIndex = 0;
                showAmigoAStory(currentAmigoAStoryIndex);
            }

            if (amigoAStoryCircle) {
                amigoAStoryCircle.addEventListener('click', openAmigoAStory);
            }
            
            if (amigoAStoryOverlay) {
                setupSwipeToClose(amigoAStoryOverlay, 'amigoATouchStartY');
            }
            const amigoAStoryLeftClick = document.getElementById('amigoAStoryLeftClick');
            const amigoAStoryRightClick = document.getElementById('amigoAStoryRightClick');

            if (amigoAStoryLeftClick) {
                amigoAStoryLeftClick.addEventListener('click', function(event) {
                    event.stopPropagation();
                    if (currentAmigoAStoryIndex > 0) {
                        showAmigoAStory(currentAmigoAStoryIndex - 1);
                    } else {
                        closeAllOverlays();
                    }
                });
            }
            if (amigoAStoryRightClick) {
                amigoAStoryRightClick.addEventListener('click', function(event) {
                    event.stopPropagation();
                    if (currentAmigoAStoryIndex < amigoAStories.length - 1) {
                        showAmigoAStory(currentAmigoAStoryIndex + 1);
                    } else {
                        closeAllOverlays();
                    }
                });
            }
            const amigoAStoryInput = document.getElementById('amigoAStoryInput');
            const amigoAStorySendButton = document.getElementById('amigoAStorySendButton');
            const amigoAReactionButton = document.getElementById('amigoAReactionButton');
            const amigoAReactionMenu = document.getElementById('amigoAReactionMenu');
            const amigoAReactionHeart = document.getElementById('amigoAReactionHeart');
            const amigoAReactionStars = document.getElementById('amigoAReactionStars');

            if (amigoAStoryInput && amigoAStorySendButton) {
                amigoAStorySendButton.addEventListener('click', function() {
                    if (amigoAStoryInput.value.trim() !== '') {
                        console.log("Mensagem Amigo A: " + amigoAStoryInput.value);
                        amigoAStoryInput.value = '';
                    }
                });
            }
            if (amigoAReactionButton) {
                amigoAReactionButton.addEventListener('click', function(event) {
                    event.stopPropagation();
                    if (amigoAReactionMenu) amigoAReactionMenu.classList.toggle('hidden');
                });
            }
            if (amigoAReactionHeart) {
                amigoAReactionHeart.addEventListener('click', function(event) {
                    event.stopPropagation();
                    console.log('Reação Amigo A: Coração');
                    if (amigoAReactionMenu) amigoAReactionMenu.classList.add('hidden');
                });
            }
            if (amigoAReactionStars) {
                amigoAReactionStars.addEventListener('click', function(event) {
                    event.stopPropagation();
                    console.log('Reação Amigo A: Estrelas');
                    if (amigoAReactionMenu) amigoAReactionMenu.classList.add('hidden');
                });
            }
            if (amigoAStoryOverlay) {
                amigoAStoryOverlay.addEventListener('click', function(event) {
                    if (amigoAReactionButton && amigoAReactionMenu && !amigoAReactionButton.contains(event.target) && !amigoAReactionMenu.contains(event.target) && !amigoAReactionMenu.classList.contains('hidden')) {
                        amigoAReactionMenu.classList.add('hidden');
                    }
                });
            }
            if (closeAmigoAStoryButtonTop) {
                closeAmigoAStoryButtonTop.addEventListener('click', closeAllOverlays);
            }

            // --- Lógica da Tela de Criar Post ---
            if (createPostFab) {
                createPostFab.addEventListener('click', function() {
                    closeAllOverlays();
                    if (createPostOverlay) createPostOverlay.classList.remove('hidden');
                    if (postContentInput) postContentInput.value = '';
                    attachedMediaPreview.classList.add('hidden');
                    previewImage.classList.add('hidden');
                    previewImage.src = '';
                    previewFileName.classList.add('hidden');
                    previewFileName.textContent = '';
                    attachedFileType = null;
                    attachedFileSrc = null;
                });
            }

            if (closeCreatePostButton) {
                closeCreatePostButton.addEventListener('click', function() {
                    if (createPostOverlay) createPostOverlay.classList.add('hidden');
                });
            }

            if (attachImageButton) {
                attachImageButton.addEventListener('click', function() {
                    imageFileInput.click();
                });
            }

            if (imageFileInput) {
                imageFileInput.addEventListener('change', function(event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            previewImage.src = e.target.result;
                            previewImage.classList.remove('hidden');
                            previewFileName.classList.add('hidden');
                            attachedMediaPreview.classList.remove('hidden');
                            attachedFileType = 'image';
                            attachedFileSrc = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    } else {
                        previewImage.classList.add('hidden');
                        previewImage.src = '';
                        attachedMediaPreview.classList.add('hidden');
                        attachedFileType = null;
                        attachedFileSrc = null;
                    }
                });
            }

            if (attachFileButton) {
                attachFileButton.addEventListener('click', function() {
                    fileAttachmentInput.click();
                });
            }

            if (fileAttachmentInput) {
                fileAttachmentInput.addEventListener('change', function(event) {
                    const file = event.target.files[0];
                    if (file) {
                        previewFileName.textContent = `Arquivo: ${file.name}`;
                        previewFileName.classList.remove('hidden');
                        previewImage.classList.add('hidden');
                        previewImage.src = '';
                        attachedMediaPreview.classList.remove('hidden');
                        attachedFileType = 'file';
                        attachedFileSrc = URL.createObjectURL(file);
                    } else {
                        previewFileName.classList.add('hidden');
                        previewFileName.textContent = '';
                        attachedMediaPreview.classList.add('hidden');
                        attachedFileType = null;
                        attachedFileSrc = null;
                    }
                });
            }

            // NOVO: Lógica do botão de tirar foto dentro do create post overlay (agora não mais aqui)
            // if (takePhotoInPostOverlayButton) {
            //     takePhotoInPostOverlayButton.addEventListener('click', function() {
            //         closeAllOverlays(); 
            //         startCamera(); 
            //     });
            // }

            // --- Publicar Novo Post no Feed ---
            if (publishPostButton) {
                publishPostButton.addEventListener('click', function() {
                    const postContent = postContentInput.value.trim();

                    if (postContent === '' && !attachedFileType) {
                        alert('Bicha, escreva algo ou anexe uma mídia para publicar um post!');
                        return;
                    }

                    const mainContainer = document.getElementById('main'); 
                    
                    const newTweetCard = document.createElement('div');
                    newTweetCard.classList.add('tweet-card', 'w-[383px]', 'border-b-2', 'border-black', 'flex', 'flex-col', 'justify-between', 'pt-2', 'pb-2', 'mx-auto', 'relative');
                    newTweetCard.dataset.type = 'tweet';
                    newTweetCard.dataset.campus = 'cla'; // Campus da Maria

                    newTweetCard.innerHTML = `
                        <div class="flex items-center px-2">
                            <img src="img/maria.png" alt="Sua Foto de Perfil" class="w-[44px] h-[44px] rounded-full object-cover mr-2">
                            <span class="font-bold text-[14px] text-gray-800">Maria - CLA - Letras</span>
                        </div>
                        <p class="text-[14px] text-justify text-gray-700 px-2 mt-1 mb-1 leading-tight">
                            ${postContent}
                        </p>
                        ${attachedFileType === 'image' ? `<img src="${attachedFileSrc}" alt="Imagem Anexada" class="w-[370px] max-h-[200px] object-contain rounded-lg mx-auto my-2 border border-gray-300">` : ''}
                        ${attachedFileType === 'file' ? `
                            <div class="w-[370px] h-[52px] bg-gray-200 rounded-lg flex items-center px-2 mx-auto my-2 relative">
                                <img src="img/clip.png" alt="Ícone de Arquivo" class="w-[40px] h-[40px] rounded object-contain mr-2">
                                <div class="flex flex-col justify-center flex-grow">
                                    <span class="font-bold text-[13px] text-gray-800">Arquivo Anexado:</span>
                                    <span class="text-[13px] text-gray-800 mt-0.5 truncate">${previewFileName.textContent.replace('Arquivo: ', '')}</span>
                                </div>
                            </div>
                        ` : ''}
                        <div class="flex justify-end items-center px-2"> 
                            <div class="flex items-center">
                                <img class="like-icon w-[20px] h-[20px] object-contain mr-1 cursor-pointer" src="img/like.png" alt="Ícone de Curtir"
                                    onerror="this.onerror=null;this.src='https://placehold.co/20x20/cccccc/000000?text=LIKE';">
                                <span class="like-count font-bold text-[11px] text-gray-800" data-liked="false">0</span>
                            </div>
                        </div>
                    `;
                    mainContainer.insertBefore(newTweetCard, mainContainer.children[2]); 
                    
                    postContentInput.value = '';
                    attachedMediaPreview.classList.add('hidden');
                    previewImage.classList.add('hidden');
                    previewImage.src = '';
                    previewFileName.classList.add('hidden');
                    previewFileName.textContent = '';
                    attachedFileType = null;
                    attachedFileSrc = null;
                    if (createPostOverlay) createPostOverlay.classList.add('hidden');

                    document.querySelectorAll('.like-icon').forEach(button => {
                        const newButton = button.cloneNode(true);
                        button.parentNode.replaceChild(newButton, button);
                        newButton.addEventListener('click', function() {
                            const likeCountSpan = this.nextElementSibling;
                            let currentLikes = parseInt(likeCountSpan.textContent);
                            const hasLiked = likeCountSpan.dataset.liked === 'true';

                            if (hasLiked) {
                                this.src = 'img/like.png';
                                currentLikes--;
                                likeCountSpan.dataset.liked = 'false';
                            } else {
                                this.src = 'img/like2.png';
                                currentLikes++;
                                likeCountSpan.dataset.liked = 'true';
                            }
                            likeCountSpan.textContent = currentLikes;
                        });
                    });
                });
            }

            // --- NOVO: Lógica da Câmera para TIRAR FOTO para Story (tela de "criar story") ---

            async function startCreateStoryCamera() {
                try {
                    createStoryLocalStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
                    createStoryVideoPreview.srcObject = createStoryLocalStream;
                    createStoryOverlay.classList.remove('hidden');
                    createStoryVideoPreview.classList.remove('hidden');
                } catch (error) {
                    console.error('Erro ao acessar a câmera para criar story:', error);
                    alert('Amada, não consegui acessar sua câmera para o story! Tem certeza que deu permissão?');
                    createStoryOverlay.classList.add('hidden');
                }
            }

            function stopCreateStoryCamera() {
                if (createStoryLocalStream) {
                    createStoryLocalStream.getTracks().forEach(track => track.stop());
                    createStoryLocalStream = null;
                    createStoryVideoPreview.srcObject = null;
                }
            }

            // AQUI: Botão de Tirar Foto DENTRO DO OVERLAY CRIAR STORY
            if (takePhotoForStoryButton) {
                takePhotoForStoryButton.addEventListener('click', function() {
                    const context = createStoryCanvas.getContext('2d');
                    createStoryCanvas.width = createStoryVideoPreview.videoWidth;
                    createStoryCanvas.height = createStoryVideoPreview.videoHeight;
                    context.drawImage(createStoryVideoPreview, 0, 0, createStoryCanvas.width, createStoryCanvas.height);
                    const newStoryPhotoDataUrl = createStoryCanvas.toDataURL('image/png');
                    
                    createNewStoryCircle(newStoryPhotoDataUrl); // Cria o novo círculo de story
                    closeAllOverlays(); // Fecha a tela de criar story
                });
            }

            if (closeCreateStoryOverlayButton) {
                closeCreateStoryOverlayButton.addEventListener('click', function() {
                    closeAllOverlays();
                });
            }

            function createNewStoryCircle(imageDataUrl) {
                newStoryCounter++;
                const newStoryId = `userNewStory${newStoryCounter}`; // ID único para o novo story

                const newStoryDiv = document.createElement('div');
                newStoryDiv.id = newStoryId;
                newStoryDiv.classList.add('relative', 'w-[63px]', 'h-[63px]', 'rounded-full', 'border-[3px]', 'border-[#e5a1ae]', 'flex-shrink-0', 'flex', 'items-center', 'justify-center', 'cursor-pointer');
                
                newStoryDiv.innerHTML = `
                    <img src="img/maria.png" alt="Seu Novo Story" class="w-[53px] h-[53px] rounded-full object-cover"
                        onerror="this.onerror=null;this.src='https://placehold.co/53x53/cccccc/000000?text=M';"
                    >
                `;
                
                // AQUI: Adiciona o novo story **depois** do story do Ciclano
                const ciclanoStoryElement = document.getElementById('ciclanoStoryCircle');
                if (ciclanoStoryElement && ciclanoStoryElement.nextElementSibling) {
                    storiesContainer.insertBefore(newStoryDiv, ciclanoStoryElement.nextElementSibling);
                } else {
                    // Fallback se Ciclano não for encontrado ou for o último
                    storiesContainer.appendChild(newStoryDiv);
                }

                newStoryDiv.addEventListener('click', function() {
                    closeAllOverlays();
                    capturedStoryImage.src = imageDataUrl; // Exibe a foto tirada
                    capturedPhotoStoryOverlay.classList.remove('hidden');
                });
            }

            if (closeCapturedStoryButton) {
                closeCapturedStoryButton.addEventListener('click', function() {
                    closeAllOverlays();
                });
            }

            // Configura swipe para fechar o overlay da câmera e do story capturado
            setupSwipeToClose(cameraOverlay, 'cameraTouchStartY'); 
            setupSwipeToClose(capturedPhotoStoryOverlay, 'capturedStoryTouchStartY'); 
            setupSwipeToClose(createStoryOverlay, 'createStoryTouchStartY'); // NOVO: Para o overlay de criar story

        }); // Fim do DOMContentLoaded
    </script>
</body>
</html>
